<cdk-virtual-scroll-viewport
  #viewport
  id="lf-list-viewport"
  [itemSize]="itemSize"
  (scrolledIndexChange)="onScroll($event)"
  (keydown)="onViewportKeyDown($event)"
>
  <table
    #matTable
    role="grid"
    mat-table
    [dataSource]="dataSource"
    class="lf-table-selection-list"
    matSort
    (matSortChange)="sortData($event)"
    [ngClass]="{
      'table-width-auto': !(columns?.length > 0)
    }"
    multiTemplateDataRows="true"
  >
    <ng-container [matColumnDef]="column.id" *ngFor="let column of allColumnDefs; let i = index">
      <ng-container [ngSwitch]="column.id">
        <!-- the same view can be shown in more than one case -->
        <ng-container *ngSwitchCase="'name'">
          <th mat-header-cell *matHeaderCellDef class="lf-ellipsis-overflow">
            <!-- <span class="resize-handle resize-handle-left" (mousedown)="onResizeColumn($event, multipleSelection ? 0 : 0)"></span> -->
            <div class="lf-resize-wrapper-div">
              <div class="column-text-div" mat-sort-header>Name</div>
              <span class="resize-handle resize-handle-right" (mousedown)="onResizeColumn($event, i)"></span>
            </div>
          </th>
          <td mat-cell *matCellDef="let item">
            <div class="icon-name-container">
              <ng-container *ngIf="listItemRef; else defaultItem"
                ><ng-container *ngIf="item">
                  <ng-container *ngTemplateOutlet="listItemRef; context: item"></ng-container>
                </ng-container>
              </ng-container>
              <ng-template #defaultItem><span class="lf-ellipsis-overflow">{{ item.value.name ?? item.value.id}}</span></ng-template>
            </div>
          </td></ng-container
        >
        <ng-container *ngSwitchCase="'select'">
          <th mat-header-cell *matHeaderCellDef>
            <!-- <mat-checkbox (change)="$event ? masterToggle() : null"
                                  [checked]="selection.hasValue() && isAllSelected()"
                                  [indeterminate]="selection.hasValue() && !isAllSelected()">
                    </mat-checkbox> -->
          </th>
          <td mat-cell class="multiselect-column" *matCellDef="let row">
            <mat-checkbox
              class="lf-checkbox multiselect-indicator lf-no-ripple"
              *ngIf="multipleSelection && row?.isSelectable"
              tabindex="-1"
              [checked]="row?.isSelected"
              color="primary"
              (click)="onCheckboxClicked($event)"
              disableRipple
              [checked]="row.isSelected"
            >
            </mat-checkbox>
          </td>
        </ng-container>
        <!--default case when there are no matches -->
        <ng-container *ngSwitchDefault>
          <th mat-header-cell *matHeaderCellDef class="lf-ellipsis-overflow">
            <div class="lf-resize-wrapper-div">
              <div class="column-text-div" mat-sort-header>
                <!-- <span class="resize-handle resize-handle-left" (mousedown)="onResizeColumn($event, i - 1)"></span> -->
                {{ column.displayName }}
              </div>
              <span
                *ngIf="i > 0"
                class="resize-handle resize-handle-right"
                (mousedown)="onResizeColumn($event, i)"
              ></span>
            </div>
          </th>
          <td mat-cell class="lf-ellipsis-overflow" *matCellDef="let row">
            <div class="column-text-div">
              {{ row.value.attributes?.get(column.id)?.displayValue }}
            </div>
          </td>
        </ng-container>
      </ng-container>
    </ng-container>
    <ng-container matColumnDef="item-description">
      <th mat-header-cell *matHeaderCellDef></th>
    </ng-container>

    <tr
      class="lf-selection-list-header-row"
      [ngClass]="{ 'lf-hidden-column-header': columns?.length < 1 }"
      mat-header-row
      [style.gridTemplateColumns]="columnsWidth"
      *matHeaderRowDef="allColumnHeaders"
    ></tr>

    <tr
      [style.height.px]="placeholderHeight"
      mat-row
      *matRowDef="let row; let index = index; columns: []; when: placeholderWhen"
    ></tr>
    <tr
      mat-row
      *matRowDef="let row; let i = dataIndex; columns: allColumnHeaders"
      tabindex="0"
      class="item-holder"
      [ngClass]="{
        'non-selectable-option': !row.isSelectable,
        'selectable-option': row.isSelectable,
        'node-selected': row.isSelected
      }"
      [attr.id]="_computeRowId(i + (dataSource?.curStart ?? 0))"
      (click)="onClickMatListOption($event, row, i + (dataSource?.curStart ?? 0))"
      (dblclick)="onDblClick($event, row)"
      (focusin)="onFocused(i + (dataSource?.curStart ?? 0))"
      (keydown)="onItemKeyDown($event, row)"
      (keyup)="onItemKeyUp($event, row)"
      [style.gridTemplateColumns]="columnsWidth"
    ></tr>
  </table>
  <div *ngIf="pressed" class="ui-grid-resize-overlay" [style.left.px]="resizePosition"></div>
</cdk-virtual-scroll-viewport>
