<cdk-virtual-scroll-viewport
  #viewport
  id="lf-list-viewport"
  [itemSize]="itemSize"
  (scrolledIndexChange)="onScroll($event)"
  (keydown)="onViewportKeyDown($event)"
>
  <table
    #matTable
    role="grid"
    mat-table
    [dataSource]="dataSource"
    class="lf-table-selection-list"
    matSort
    (matSortChange)="sortData($event)"
    [ngClass]="{
      'table-width-auto': !(columns?.length > 0)
    }"
    multiTemplateDataRows="true"
  >
    <ng-container [matColumnDef]="column.id" *ngFor="let column of allColumnDefs; let i = index">
      <ng-container [ngSwitch]="column.id">
        <!-- the same view can be shown in more than one case -->
        <ng-container *ngSwitchCase="'name'">
          <th mat-header-cell *matHeaderCellDef class="lf-ellipsis-overflow">
            <!-- <span class="resize-handle resize-handle-left" (mousedown)="onResizeColumn($event, multipleSelection ? 0 : 0)"></span> -->
            <div class="column-text-div" mat-sort-header>Name</div>
            <span class="resize-handle resize-handle-right" (mousedown)="onResizeColumn($event, i)"></span>
          </th>
          <td
            mat-cell
            *matCellDef="let row"
          >
            <div class="icon-name-container">
              <div *ngIf="getIcons(row.value).length > 0" class="fixed-size-icon-container">
                <img *ngFor="let icon of getIcons(row.value)" src="{{ icon }}" alt="" class="lf-entry-icon" />
              </div>
              <div title="{{ row.value?.name }}" class="lf-ellipsis-overflow">{{ row.value?.name }}</div>
            </div>
          </td></ng-container
        >
        <ng-container *ngSwitchCase="'select'">
          <th mat-header-cell *matHeaderCellDef>
            <!-- <mat-checkbox (change)="$event ? masterToggle() : null"
                                  [checked]="selection.hasValue() && isAllSelected()"
                                  [indeterminate]="selection.hasValue() && !isAllSelected()">
                    </mat-checkbox> -->
          </th>
          <td
            mat-cell
            class="multiselect-column"
            *matCellDef="let row"
          >
            <mat-checkbox
              class="lf-checkbox multiselect-indicator lf-no-ripple"
              *ngIf="multipleSelection && row?.isSelectable"
              tabindex="-1"
              [checked]="row?.isSelected"
              color="primary"
              (click)="onCheckboxClicked($event)"
              disableRipple
              [checked]="row.isSelected"
            >
            </mat-checkbox>
          </td>
        </ng-container>
        <!--default case when there are no matches -->
        <ng-container *ngSwitchDefault>
          <th mat-header-cell *matHeaderCellDef class="lf-ellipsis-overflow">
            <span class="resize-handle resize-handle-left" (mousedown)="onResizeColumn($event, i - 1)"></span>
            <div class="column-text-div" mat-sort-header>
              {{ column.displayName }}
            </div>
            <span
              *ngIf="i === allColumnDefs.length - 1"
              class="resize-handle resize-handle-right"
              (mousedown)="onResizeColumn($event, i)"
            ></span>
          </th>
          <td
            mat-cell
            class="lf-ellipsis-overflow"
            *matCellDef="let row"
          >
            <div class="column-text-div">
              {{ row.value.attributes?.get(column.id)?.displayValue }}
            </div>
          </td>
        </ng-container>
      </ng-container>
    </ng-container>
    <ng-container matColumnDef="item-description">
      <th mat-header-cell *matHeaderCellDef></th>
    </ng-container>


    <tr
      class="lf-selection-list-header-row"
      [ngClass]="{ 'lf-hidden-column-header': columns?.length < 1 }"
      mat-header-row [style.gridTemplateColumns]="columnsWidth"
      *matHeaderRowDef="allColumnHeaders; sticky: true"
    ></tr>

    <tr
      [style.height.px]="placeholderHeight"
      mat-row
      *matRowDef="let row; let index = index; columns: []; when: placeholderWhen"
    ></tr>
    <tr
      mat-row
      *matRowDef="let row; let i = dataIndex; columns: allColumnHeaders"
      tabindex="0"
      class="item-holder"
      [ngClass]="{
        'non-selectable-option': !row.isSelectable,
        'selectable-option': row.isSelectable,
        'node-selected': row.isSelected
      }"
      [attr.id]="_computeRowId(i + (dataSource?.curStart ?? 0))"
      (click)="onClickMatListOption($event, row, i + (dataSource?.curStart ?? 0))"
      (dblclick)="onDblClick($event, row)"
      (focusin)="onFocused(i + (dataSource?.curStart ?? 0))"
      (keydown)="onItemKeyDown($event, row)"
      (keyup)="onItemKeyUp($event, row)"
      [style.gridTemplateColumns]="columnsWidth"
    ></tr>

    <!-- <ng-template
      let-row
      let-i="index"
      matRowDef
      cdkVirtualFor
      [matRowDefColumns]="allColumnHeaders"
      [cdkVirtualForOf]="items"
    >
      <tr [style.gridTemplateColumns]="columnsWidth"
        mat-row
        tabindex="0"
        class="test-class-help item-holder"
        [attr.id]="_computeRowId(i)"
        (click)="onClickMatListOption($event, row, i)"
        (dblclick)="onDblClick($event, row)"
        (focusin)="onFocused(i)"
        (keydown)="onItemKeyDown($event, row)"
        (keyup)="onItemKeyUp($event, row)"
      ></tr>
    </ng-template> -->
  </table>
</cdk-virtual-scroll-viewport>
